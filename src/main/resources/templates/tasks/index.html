<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    lang="en"
>
    <head>
        <th:block
            th:replace="~{partials/partials :: head (title='Task Lister')}"
        ></th:block>
    </head>
    <body>
        <nav th:insert="~{partials/partials :: navbar}"></nav>
        <header th:insert="~{partials/partials :: header}"></header>

        <form action="/tasks/search" method="GET">
            <label for="search">Find Task</label>
            <input type="text" name="search" id="search" />
            <button>Search</button>
        </form>
        <div th:if="${results}">
            <ul>
                <li th:each="task : ${results}">
                    <h2 th:text="${task.title}"></h2>
                    <p th:text="${task.description}"></p>
                </li>
            </ul>
        </div>

        <div th:each="listingAll : ${listAllTasks}">
            <h2>
                <a
                    th:text="${listingAll.title}"
                    th:href="@{|/tasks/${listingAll.id}|}"
                ></a>
            </h2>
            <p th:text="${listingAll.description}"></p>
            <!-- <span th:text="${listingAll.publishDate}"></span> -->
            <div th:each="findCategoryName : ${listingAll.categories}">
                <h4 th:text="${findCategoryName.name}"></h4>
            </div>

            <!-- THIS GETS PUBLISH DATE SO WE CAN CONVERT -->
            <span
                id="publish"
                th:text="${listingAll.publishDate}"
                hidden
            ></span>
            <p>
                Posted on:
                <span id="publishAgain"></span>
            </p>
            <p>Due on: <span th:text="${listingAll.taskDueDate}"></span></p>
        </div>

        <script>
            let grabCurrentPublishFormat =
                document.getElementById("publish").textContent;
            let changeCurrentPublishFormat = new Date(grabCurrentPublishFormat);
            let newFormat = {
                day: "2-digit",
                month: "short",
                year: "numeric",
            };
            let formatDate = changeCurrentPublishFormat.toLocaleString(
                "en-gb",
                newFormat
            );
            // https://blog.enterprisedna.co/how-to-convert-string-to-date-in-javascript-in-dd-mmm-yyyy-format/#:~:text=You%20can%20convert%20strings%20to,or%20the%20date%2Dfns%20libraries.

            // console.log("vvvvv: " + formatDate);
            let getSpaceToInputNewPublish =
                document.getElementById("publishAgain");
            let newPublishFormat = document.createTextNode(formatDate);
            getSpaceToInputNewPublish.appendChild(newPublishFormat);
            // https://stackoverflow.com/questions/41764061/adding-text-to-an-existing-text-element-in-javascript-via-dom
        </script>
    </body>
</html>
