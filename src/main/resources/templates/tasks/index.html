<!DOCTYPE html>
<html
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    lang="en"
>
    <head>
        <th:block
            th:replace="~{partials/partials :: head (title='Task Lister')}"
        ></th:block>
        <link rel="stylesheet" th:href="@{/css/indexCards.css}" />
    </head>
    <body>
        <div th:insert="~{partials/partials :: navbar}"></div>
        <header th:insert="~{partials/partials :: header}"></header>

        <form role="search" action="/tasks/search" method="GET" id="searchForm">
            <!-- <label for="search">Find Task</label> -->
            <div class="row mb-3">
                <div class="col-sm-3">
                    <input
                        class="form-control me-2"
                        type="search"
                        name="search"
                        id="search"
                        placeholder="Search Task"
                        aria-label="Search Task"
                    />
                </div>

                <div class="col-sm-2">
                    <button class="btn btn-outline-success" type="submit">
                        Search
                    </button>
                </div>
            </div>
        </form>

        <!-- This is when the user searches by TITLE or DESCRIPTION -->
        <!-- <div th:if="${results}">
            <div th:each="task : ${results}">
                <h2 th:text="${task.title}"></h2>
                <p th:text="${task.description}"></p>
                <div th:each="findCategoryName : ${task.categories}">
                    <h4 th:text="${findCategoryName.name}"></h4>
                </div>
            </div>
        </div> -->

        <!-- This is when the user searches by CATEGORY -->
        <!-- <div th:if="${results2}">
            <div th:each="task : ${results2}">
                <h2 th:text="${task.title}"></h2>
                <p th:text="${task.description}"></p>
                <h4 th:text="${categoryName.getName}"></h4>
            </div>
        </div> -->
        <br />
        <!-- <div th:insert="~{partials/partials :: pagination}"></div> -->

        <div id="b">
            <div th:each="listingAll : ${listAllTasks}">
                <div class="card m-2" style="width: 18rem" id="allCards">
                    <div class="card-body">
                        <h2>
                            <a
                                th:text="${listingAll.title}"
                                th:href="@{|/tasks/${listingAll.id}|}"
                            ></a>
                        </h2>
                    </div>
                    <div class="card-body text-bg-light">
                        <p th:text="${listingAll.description}"></p>
                    </div>
                    <!-- <span th:text="${listingAll.publishDate}"></span> -->
                    <div
                        class="card-body"
                        th:each="findCategoryName : ${listingAll.categories}"
                    >
                        <h4 th:text="${findCategoryName.name}"></h4>
                    </div>

                    <!-- <span th:text="${listingAll.isComplete}"></span> -->

                    <!-- THIS GETS PUBLISH DATE SO WE CAN CONVERT -->
                    <ul class="list-group list-group-flush">
                        <span
                            class="getPublishDate"
                            th:text="${listingAll.publishDate}"
                            hidden
                        ></span>
                        <p class="list-group-item">
                            Posted on:
                            <span class="publishNewDate"></span>
                        </p>

                        <span
                            class="getOldTaskDate"
                            th:text="${listingAll.taskDueDate}"
                            hidden
                        ></span>
                        <p class="list-group-item">
                            Due by: <span class="showNewTaskFormatDate"></span>
                        </p>

                        <div
                            class="list-group-item"
                            th:if="${listingAll.isComplete == 'false'}"
                        >
                            <span>Task Incomplete</span>
                        </div>
                        <div
                            class="list-group-item"
                            th:if="${listingAll.isComplete == 'true'}"
                        >
                            <span>Task Complete</span>
                        </div>
                        <!-- <hr /> -->
                    </ul>
                    <!-- </div> -->
                </div>
            </div>
        </div>
        <!-- </div>
        </div> -->

        <!-- Build the pagination component -->
        <div id="paginate">
            <div th:insert="~{partials/partials :: pagination}"></div>
        </div>

        <div th:insert="~{partials/partials :: script}"></div>

        <script src="../js/formatDate.js"></script>
    </body>
</html>
